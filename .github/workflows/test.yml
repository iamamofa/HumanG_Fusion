name: CI - Nextflow Fusion Pipeline

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Nextflow
        run: |
          curl -s https://get.nextflow.io | bash
          sudo mv nextflow /usr/local/bin/

      - name: Build Docker image
        run: |
          docker build -t fusion-pipeline:ci docker/

      - name: Run pipeline (sample_data)
        run: |
          nextflow run main.nf -profile docker \
            --reads "./sample_data/*_R1.fastq.gz" \
            --outdir "./results" \
            --star_index "/tmp/STAR_index" \
            --genome_fasta "/tmp/genome.fa" \
            --gtf "/tmp/genes.gtf" \
            --kraken_decontam false
